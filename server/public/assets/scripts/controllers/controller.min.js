/*! rtc.io 2016-01-29 */
var myApp=angular.module("myApp");myApp.controller("LobbyController",["$scope","ngAudio",function(a,b){console.log("lobby controller");var c=io.connect("http://localhost:5000");a.option="",a.kiosk=!1,a.user=!1,a.options=["visitor","option1","option2","option3","option4","option5","option6"],a.newArray=[],a.loggedIn=!1,a.link=!1,a.unavailable=!1,a.i=0,a.answered=!1,c.on("optionArray",function(b){console.log(b),a.newArray=[],a.newArray=b.array;for(var c=0;c<a.options.length;c++)for(var d=0;d<a.newArray.length;d++)a.options[c]==a.newArray[d]&&a.options.splice(c,1)}),c.on("entrance",function(a){}),c.on("call",function(a){console.log("a call has been made")}),c.on("invite",function(b){console.log("you have been invited"+b.link),a.incomingCall(),a.soundFunction()}),c.on("accepted",function(b){a.acceptedFunction()}),c.on("unavailable",function(b){a.unavailable=!scope.unavailable}),c.on("exit",function(a){}),a.soundFunction=function(){a.i++,a.audio=b.load("http://www.soundjay.com/phone/sounds/telephone-ring-03a.mp3"),a.audio.play(),console.log("ring "+a.i),a.i<4&&0==a.answered?setTimeout(a.soundFunction,6e3):a.i>=4&&0==a.answered&&(console.log(a.option),c.emit("noAnswer",{option:a.option}),a.i=0,a.link=!1)},a.incomingCall=function(b){a.link=!0},a.receivingCall=function(){console.log("i am taking the call"),c.emit("callAccepted")},a.kioskLogin=function(){a.getOptions(),a.kiosk=!a.kiosk},a.acceptedFunction=function(){a.link=!1,a.answered=!0},a.getOptions=function(){c.emit("getOptions")},a.callFunction=function(){c.emit("call",{call:a.option})},a.loginFunction=function(b){console.log(b),a.loggedIn=!a.loggedIn,c.emit("login",{option:b}),"visitor"==b?a.kiosk=!a.kiosk:a.user=!a.user},a.getOptions()}]),myApp.controller("VideoChatController",["$scope","VideoSetup",function(a,b){console.log("videochat controller"),b.videoFunction()}]),myApp.factory("VideoSetup",function(){var a=function(){var a={room:"test-room",signaller:"ws://localhost:5000"},b=RTC(a),c=document.getElementById("l-video"),d=document.getElementById("r-video");console.log(c),console.log(d),console.log(b.local),console.log(b.remote),c.appendChild(b.local),d.appendChild(b.remote),b.on("ready",init)};return{videoFunction:a}});